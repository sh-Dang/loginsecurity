## 로그인 사용자 정보 조회(/info) 및 로그아웃(/logout) 기능 구현

**날짜:** 2025-09-12

### 1. 주요 구현 기능

이번 세션에서는 사용자가 로그인한 후, 자신의 정보를 조회하고 안전하게 로그아웃하는 기능의 프론트엔드와 백엔드 로직을 완성했다.

#### 1.1. 프론트엔드 (`main.html`)

- **정보 조회 (`getInfoBtn`):**
    - '내 정보 가져오기' 버튼 클릭 시, 브라우저 `localStorage`에 저장된 JWT 액세스 토큰을 가져온다.
    - `Authorization: Bearer <token>` 헤더를 포함하여 백엔드의 `/info` API를 호출한다.
    - API로부터 받은 사용자 정보(이름, 역할 등)를 화면에 JSON 형태로 출력한다.

- **로그아웃 (`logoutForm`):**
    - '로그아웃' 버튼 클릭 시, `localStorage`의 JWT 액세스 토큰을 삭제한다.
    - 서버의 리프레시 토큰을 무효화하기 위해 백엔드의 `/logout` API를 호출한다.
    - 모든 처리가 끝나면 사용자를 로그인 페이지로 리디렉션한다.

#### 1.2. 백엔드 (`UserController.java`)

- **`GET /info` API 구현:**
    - 인증된 사용자의 요청만 허용한다.
    - Spring Security의 `Authentication` 객체를 통해 현재 로그인된 사용자의 `username`과 `authorities`(역할) 정보를 추출한다.
    - 추출된 정보를 `Map` 또는 DTO에 담아 JSON 형태로 클라이언트에 반환한다.

- **`POST /logout` API 구현 (보안 강화):**
    - 단순 로그아웃이 아닌, 서버와 클라이언트 양쪽에서 세션을 완전히 종료시키는 '상태 저장 로그아웃'을 구현했다.
    - **서버 측:** `Authentication` 객체에서 사용자 이름을 얻어, Redis에 저장된 해당 유저의 리프레시 토큰을 **삭제**한다.
    - **클라이언트 측:** 응답(response)에 `Max-Age=0`으로 설정된 `refreshToken` 쿠키를 담아 보내, 브라우저가 즉시 해당 쿠키를 삭제하도록 지시한다.

### 2. 학습한 핵심 개념

- **인증된 API 호출:** 클라이언트에서 서버로 API를 요청할 때, HTTP 헤더에 JWT를 담아 보내 인증 상태를 증명하는 방법을 학습했다.
- **사용자 정보 추출:** 서버에서 Spring Security가 관리하는 `SecurityContext`의 `Authentication` 객체로부터 현재 사용자의 상세 정보를 안전하게 가져오는 방법을 이해했다.
- **안전한 로그아웃 (Secure Logout):** JWT 기반 환경에서 진정한 로그아웃은 클라이언트의 토큰 삭제만으로는 불충분함을 인지했다. 서버 측의 리프레시 토큰 저장소(Redis)에서 해당 토큰을 반드시 제거해야만 탈취된 리프레시 토큰의 재사용을 막을 수 있다는 것을 배웠다. 또한, `HttpOnly` 쿠키를 삭제시키는 방법도 학습했다.
